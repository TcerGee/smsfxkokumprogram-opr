<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem OPR - SM St. Francis Xavier</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Roboto (Rasmi) & Inter (UI) -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- html2pdf.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            overflow: hidden; /* Mengurus scroll di dalam panel berasingan */
        }

        /* --- A4 PREVIEW CONTAINER --- */
        #a4-preview-container {
            width: 210mm;
            height: 296mm; /* Saiz A4 Tetap */
            margin: 0 auto;
            position: relative;
            background-color: white;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            overflow: hidden; /* Pastikan konten tidak terkeluar */
            color: #000;
        }

        /* --- BACKGROUND STYLING --- */
        .bg-gradient-custom {
            position: absolute;
            inset: 0;
            /* Gabungan Hijau, Kuning, Biru Terang */
            background: linear-gradient(135deg, #dcfce7 0%, #fef9c3 50%, #dbeafe 100%);
            z-index: 0;
        }

        /* Corak Pencil Art (SVG Pattern) */
        .pencil-art-overlay {
            position: absolute;
            inset: 0;
            opacity: 0.1;
            /* Corak abstrak seakan lakaran pensil */
            background-image: url("data:image/svg+xml,%3Csvg width='80' height='80' viewBox='0 0 80 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' stroke='%23333' stroke-width='1'%3E%3Cpath d='M10 10 L20 20 M20 10 L10 20' /%3E%3Ccircle cx='50' cy='50' r='15' /%3E%3Cpath d='M60 10 Q70 20 60 30 T60 50' /%3E%3Crect x='10' y='50' width='20' height='20' /%3E%3Cpath d='M50 10 L50 20' /%3E%3C/g%3E%3C/svg%3E");
            z-index: 1;
        }

        /* Ilustrasi Besar (Abstract Sport Pencil Sketch Style) */
        .illustration-icon {
            position: absolute;
            bottom: 100px;
            right: -20px;
            width: 350px;
            height: 350px;
            opacity: 0.12;
            z-index: 1;
            transform: rotate(-10deg);
            pointer-events: none;
            filter: grayscale(100%);
        }

        /* --- CONTENT LAYER --- */
        .content-layer {
            position: relative;
            z-index: 10;
            padding: 10mm 15mm;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        /* --- TABLE STYLING --- */
        .report-table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'Roboto', sans-serif;
            font-size: 10.5pt;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #000;
        }
        .report-table td {
            border: 1px solid #000;
            padding: 5px 8px;
            vertical-align: top;
            line-height: 1.3;
        }
        .label-col {
            width: 28%;
            font-weight: 700;
            background-color: #d1fae5; /* Hijau cair sangat lembut */
            color: #000;
        }

        /* --- IMAGE GRID --- */
        .img-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        .img-box {
            height: 130px; /* Tinggi tetap supaya muat 1 page */
            border: 1px solid #000;
            background: #f3f4f6;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        .img-box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Input Form Styles */
        .form-group { margin-bottom: 10px; }
        .form-label {
            display: block;
            font-size: 0.85rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 2px;
        }
        .form-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            font-size: 0.9rem;
            background: #fff;
        }
        .form-input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
        }

        /* --- HEADER SPECIFICS (CUSTOM REQUEST) --- */
        .header-title-main {
            background-color: #15803d; /* Hijau Gelap */
            color: #ffffff; /* Putih */
            font-weight: 700; /* Bold */
            padding: 4px 12px;
            display: inline-block; /* Kunci: Elak outline panjang */
            font-family: 'Roboto', sans-serif;
            font-size: 1.25rem;
            text-transform: uppercase;
            margin-bottom: 6px;
            border-radius: 2px;
        }

        .header-subtitle {
            background-color: #1e3a8a; /* Biru Gelap */
            color: #facc15; /* Kuning Terang */
            font-weight: 700; /* Bold */
            padding: 4px 12px;
            display: inline-block; /* Kunci: Elak outline panjang */
            font-family: 'Roboto', sans-serif;
            font-size: 1.5rem;
            text-transform: uppercase;
            border-radius: 2px;
        }

    </style>
</head>
<body class="flex flex-col h-screen">

    <!-- NAVBAR -->
    <nav class="bg-blue-900 text-white p-3 shadow-lg flex-none z-50">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-white/10 p-2 rounded">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                </div>
                <h1 class="text-lg font-bold tracking-wide">GENERATOR OPR SMSFX</h1>
            </div>
            <button onclick="generatePDF()" id="btnGenerate" class="bg-yellow-400 hover:bg-yellow-500 text-black font-extrabold py-2 px-6 rounded shadow transform hover:scale-105 transition flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
                JANA PDF
            </button>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <div class="flex flex-1 overflow-hidden">
        
        <!-- LEFT PANEL: FORM -->
        <div class="w-full md:w-1/3 bg-white border-r border-gray-200 p-6 overflow-y-auto pb-20 shadow-xl z-20">
            <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">Butiran Laporan</h2>
            
            <form id="oprForm" onsubmit="return false;">
                <!-- Fields -->
                <div class="form-group">
                    <label class="form-label">Nama Program / Aktiviti</label>
                    <input type="text" class="form-input" id="in_program" placeholder="Cth: Latihan Merentas Desa" oninput="updateText('program', this.value)">
                </div>
                <div class="form-group">
                    <label class="form-label">Pengelola</label>
                    <input type="text" class="form-input" id="in_pengelola" placeholder="Unit Kokurikulum" oninput="updateText('pengelola', this.value)">
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <div class="form-group">
                        <label class="form-label">Tarikh</label>
                        <input type="date" class="form-input" id="in_tarikh" oninput="updateDate(this.value)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Masa</label>
                        <input type="text" class="form-input" id="in_masa" placeholder="8.00 - 10.00 Pagi" oninput="updateText('masa', this.value)">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Tempat</label>
                    <input type="text" class="form-input" id="in_tempat" placeholder="Padang Sekolah" oninput="updateText('tempat', this.value)">
                </div>
                <div class="form-group">
                    <label class="form-label">Objektif Program</label>
                    <textarea rows="3" class="form-input" id="in_objektif" placeholder="Senaraikan objektif..." oninput="updateText('objektif', this.value)"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Sasaran</label>
                    <input type="text" class="form-input" id="in_sasaran" placeholder="Semua Pelajar" oninput="updateText('sasaran', this.value)">
                </div>
                <div class="form-group">
                    <label class="form-label">Impak Program</label>
                    <textarea rows="3" class="form-input" id="in_impak" placeholder="Kesan kepada pelajar..." oninput="updateText('impak', this.value)"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Cadangan Penambahbaikan</label>
                    <textarea rows="2" class="form-input" id="in_cadangan" placeholder="Cadangan masa depan..." oninput="updateText('cadangan', this.value)"></textarea>
                </div>

                <!-- Images -->
                <div class="mt-6 border-t pt-4">
                    <h3 class="font-bold text-gray-800 mb-2">Muat Naik Gambar</h3>
                    <div class="bg-blue-50 p-3 rounded border border-blue-100">
                        <p class="text-xs font-bold text-blue-800 mb-1">3 Gambar Atas</p>
                        <input type="file" accept="image/*" class="w-full text-xs mb-1" onchange="previewImage(this, 'img1')">
                        <input type="file" accept="image/*" class="w-full text-xs mb-1" onchange="previewImage(this, 'img2')">
                        <input type="file" accept="image/*" class="w-full text-xs mb-1" onchange="previewImage(this, 'img3')">
                        
                        <p class="text-xs font-bold text-blue-800 mb-1 mt-3">3 Gambar Bawah</p>
                        <input type="file" accept="image/*" class="w-full text-xs mb-1" onchange="previewImage(this, 'img4')">
                        <input type="file" accept="image/*" class="w-full text-xs mb-1" onchange="previewImage(this, 'img5')">
                        <input type="file" accept="image/*" class="w-full text-xs mb-1" onchange="previewImage(this, 'img6')">
                    </div>
                </div>

                <!-- Signature -->
                <div class="mt-6 border-t pt-4 mb-8">
                    <h3 class="font-bold text-gray-800 mb-2">Penyedia Laporan</h3>
                    <div class="form-group">
                        <label class="form-label">Nama Anda</label>
                        <input type="text" class="form-input" id="in_nama_sedia" placeholder="Nama Penuh" oninput="updateText('nama_sedia', this.value.toUpperCase())">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Jawatan</label>
                        <input type="text" class="form-input" id="in_jawatan_sedia" placeholder="Cth: Setiausaha Sukan" oninput="updateText('jawatan_sedia', this.value)">
                    </div>
                </div>
            </form>
        </div>

        <!-- RIGHT PANEL: PREVIEW -->
        <div class="w-full md:w-2/3 bg-gray-600 p-8 overflow-auto flex justify-center relative">
            <div class="absolute top-2 left-0 w-full text-center text-white/50 text-xs font-bold tracking-widest pointer-events-none">LIVE PREVIEW MODE</div>
            
            <!-- A4 PAGE START -->
            <div id="a4-preview-container">
                
                <!-- Backgrounds -->
                <div class="bg-gradient-custom"></div>
                <div class="pencil-art-overlay"></div>
                <!-- Abstract Pencil Icon -->
                <svg class="illustration-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                </svg>

                <!-- Content Layer -->
                <div class="content-layer">
                    
                    <!-- Header -->
                    <div class="flex items-center gap-4 mb-5 pb-1">
                        <!-- Logo -->
                        <div class="w-[120px] flex-shrink-0 flex items-center justify-center">
                            <img src="https://i.postimg.cc/jjCBnTqd/edited-LOGO-SMSFX.png" 
                                 class="w-full h-auto object-contain" 
                                 crossorigin="anonymous">
                        </div>
                        
                        <!-- Titles Stacked (Left Aligned next to Logo) -->
                        <div class="flex-grow flex flex-col justify-center items-start">
                            <div class="header-title-main">
                                LAPORAN PROGRAM UNIT KOKURIKULUM
                            </div>
                            <div class="header-subtitle">
                                ONE PAGE REPORT
                            </div>
                        </div>
                    </div>

                    <!-- Table -->
                    <table class="report-table shadow-sm">
                        <tr>
                            <td class="label-col">NAMA PROGRAM</td>
                            <td id="out_program" class="font-bold uppercase text-lg">-</td>
                        </tr>
                        <tr>
                            <td class="label-col">PENGELOLA</td>
                            <td id="out_pengelola">-</td>
                        </tr>
                        <tr>
                            <td class="label-col">TARIKH & MASA</td>
                            <td>
                                <span id="out_tarikh" class="font-semibold">-</span> &nbsp;|&nbsp; <span id="out_masa">-</span>
                            </td>
                        </tr>
                        <tr>
                            <td class="label-col">TEMPAT</td>
                            <td id="out_tempat">-</td>
                        </tr>
                        <tr>
                            <td class="label-col">OBJEKTIF PROGRAM</td>
                            <td id="out_objektif" class="text-justify whitespace-pre-line">-</td>
                        </tr>
                        <tr>
                            <td class="label-col">SASARAN</td>
                            <td id="out_sasaran">-</td>
                        </tr>
                        <tr>
                            <td class="label-col">IMPAK PROGRAM</td>
                            <td id="out_impak" class="text-justify whitespace-pre-line">-</td>
                        </tr>
                        <tr>
                            <td class="label-col">CADANGAN PENAMBAHBAIKAN</td>
                            <td id="out_cadangan" class="italic text-gray-700">-</td>
                        </tr>
                    </table>

                    <!-- Photo Section -->
                    <div class="mt-3 flex-grow">
                        <div class="flex items-center gap-2 mb-1">
                            <div class="w-2 h-6 bg-blue-900"></div>
                            <h3 class="font-bold text-blue-900 uppercase text-sm">Dokumentasi Bergambar</h3>
                        </div>

                        <!-- Grid Top -->
                        <div class="img-grid">
                            <div class="img-box"><img id="out_img1" src="" class="hidden"></div>
                            <div class="img-box"><img id="out_img2" src="" class="hidden"></div>
                            <div class="img-box"><img id="out_img3" src="" class="hidden"></div>
                        </div>
                        <!-- Grid Bottom -->
                        <div class="img-grid">
                            <div class="img-box"><img id="out_img4" src="" class="hidden"></div>
                            <div class="img-box"><img id="out_img5" src="" class="hidden"></div>
                            <div class="img-box"><img id="out_img6" src="" class="hidden"></div>
                        </div>
                    </div>

                    <!-- Footer Signatures -->
                    <div class="flex justify-between items-end mt-2 pt-2 border-t-2 border-gray-400">
                        
                        <!-- Left: Dynamic -->
                        <div class="w-5/12 text-sm text-gray-900">
                            <p class="mb-8 italic">Disediakan oleh :</p>
                            <p class="font-bold uppercase underline" id="out_nama_sedia">................................................</p>
                            <p class="font-semibold" id="out_jawatan_sedia">JAWATAN</p>
                        </div>

                        <!-- Right: Static -->
                        <div class="w-5/12 text-sm text-right text-gray-900">
                            <p class="mb-8 italic">Disahkan oleh :</p>
                            <p class="font-bold uppercase underline">ANGELA ANN DAVID</p>
                            <p class="font-semibold">PK KOKURIKULUM</p>
                        </div>

                    </div>

                </div>
            </div>
            <!-- A4 PAGE END -->

        </div>
    </div>

    <script>
        // 1. Live Text Update
        function updateText(id, value) {
            const el = document.getElementById('out_' + id);
            if(el) {
                if(value.trim() === "") el.innerText = "-";
                else el.innerText = value;
            }
        }

        // 2. Date Formatter
        function updateDate(val) {
            if(!val) {
                document.getElementById('out_tarikh').innerText = "-";
                return;
            }
            const date = new Date(val);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            document.getElementById('out_tarikh').innerText = `${day}/${month}/${year}`;
        }

        // 3. Image Preview
        function previewImage(input, imgId) {
            const file = input.files[0];
            const imgEl = document.getElementById('out_' + imgId);
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imgEl.src = e.target.result;
                    imgEl.classList.remove('hidden');
                    imgEl.parentElement.style.background = "#fff"; // remove grey placeholder
                }
                reader.readAsDataURL(file);
            } else {
                imgEl.src = "";
                imgEl.classList.add('hidden');
                imgEl.parentElement.style.background = "#f3f4f6";
            }
        }

        // 4. Generate PDF
        function generatePDF() {
            const element = document.getElementById('a4-preview-container');
            const btn = document.getElementById('btnGenerate');
            const originalText = btn.innerHTML;

            // Loading state
            btn.innerHTML = `<svg class="animate-spin h-5 w-5 mr-2" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> MENJANA...`;
            btn.disabled = true;

            const opt = {
                margin:       0,
                filename:     'Laporan_OPR_SMSFX.pdf',
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { 
                    scale: 2, // 2 is good balance for speed/quality
                    useCORS: true, // IMPORTANT for external logo
                    scrollY: 0
                },
                jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().set(opt).from(element).save().then(() => {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }).catch(error => {
                console.error("PDF Error:", error);
                alert("Ralat semasa menjana PDF. Sila pastikan sambungan internet stabil untuk memuatkan logo.");
                btn.innerHTML = originalText;
                btn.disabled = false;
            });
        }
    </script>
</body>
</html>
